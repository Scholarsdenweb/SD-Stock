{% extends "catalogue/main.html" %}
{% load partials %}
{% load widget_tweaks %}
{% block page_content %}

{% startpartial key_value %}
    <div class="keyvalue">
        <input type="text" placeholder="Key" name='key'>
        <input type="text" placeholder="Value" name='val'>
        <button class="btn btn-close border border-1 border-danger bg-danger text-white rounded-circle btn-danger"  onclick="this.closest('.keyvalue').remove()"></button>
    </div>
{% endpartial %}

{% startpartial optionpart %}
        <div class="form-group" id="productoptions">
            <label for="{{form.product.id_for_label }}" class="form-label">{{form.product.label}}</label>
            <select name="{{form.product.html_name}}" id="" class='form-select'>
                {% for val, text in form.product.field.choices %}
                    <option value="{{val}}" {% if val|stringformat:"s" == item_id|stringformat:"s" %}selected{% endif %}>{{text}}</option>
                {% endfor %}                
            </select>
        </div>
{% endpartial %}



<div class="container box-container">
    <div class="row my-5">
        <div class="col-md-6 col-lg-6 mx-auto col {% if variants %} mx-atuo {% endif %}" >
   
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
    
            <form action="{% if instance_id %}{% url 'catalogue:update_variant' instance_id %}{% else %}{% url 'catalogue:add_variant' %}{% endif %}" method="post" class="text-dark border border-danger p-2" enctype=multipart/form-data>
                {% if instance_id %}
                <h3 class="text-danger">Update Variant</h3>
                {% else %}
                <h3 class="text-danger">Add Variant</h3>
                {% endif %}

             
                {% for error in form.non_field_errors %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {{ error }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}

                {% csrf_token %} 
                <div class="form-group">
                    <label for="{{form.category.id_for_label }}" class="form-label">{{form.category.label}}</label>
                    <select name="{{form.category.html_name}}" class='form-select'
                    hx-get="{% url 'stock:category_product' %}"
                    hx-swap="outerHTML"
                    hx-trigger="change"
                    hx-target="#productoptions">
                        {% for val, text in form.category.field.choices %}
                            <option value="{{val}}" {% if val|stringformat:"s" == cat_id|stringformat:"s" %}selected{% endif %}>{{text}}</option>
                        {% endfor %}                
                    </select>
                </div>

                {% partial optionpart %}


                <div class="form-group">
                    <label for="{{form.name.id_for_label }}" class="form-label">{{form.name.label}}</label>
                    {{form.name}}

                </div>
                <div class="form-group">
                    <label for="{{form.sku.id_for_label }}" class="form-label">{{form.sku.label|upper}}</label>
                    {{form.sku}}
                </div>

                <div class="form group">
                    {{ form.photo.label }}
                    {{ form.photo }}

                    {% for error in form.photo.errors %}
                        <p class="text-danger bg-light mt-1">{{ error }}</p>
                    {% endfor %}
                </div>

                <div class="form-group">
                    <label for="{{form.meta_data.id_for_label }}">{{form.meta_data.label}}</label><br>
                    <p><small class="text-warning">Exmaple: key=color, value=red</small></p>
                    <input type="text" placeholder="Key" name='key'>
                    <input type="text" placeholder="Value" name='val'>
                    <button type="text" value="Add More" role='button' class='btn btn-sm btn-dark'
                     hx-get="{% url 'catalogue:add_variant' %}"
                     hx-target="#id_key_value"
                     hx-swap="beforeend">Add More</button>

                </div>
                <div id="id_key_value"></div>

                <div class="form-group">
                    {{form.is_serialized}}
                    <label for="{{form.is_serialized.id_for_label }}" class="form-label">{{form.is_serialized.label}}</label>
                    
                </div>

                <div class="form-group" id="serial_container">

                </div>

                <button type='submit' class="btn btn-danger mt-3">Submit</button>
            </form>
           
    
        </div>

        {% if variants %}
        
        <div class="col-md-6 col-lg-6">
            <div class="border border-danger p-2  right-list-box">
                <h3 class="text-danger">Click To Edit</h3>
                <ul class='my-2 overflow-y-auto category-grid'>
                    {% for variant in variants %}
                        <li class='text-dark'>
                            <a href="{% url 'catalogue:update_variant' variant.pk %}">{{variant.name|capfirst}}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}


    </div>
</div>

{% endblock page_content %}